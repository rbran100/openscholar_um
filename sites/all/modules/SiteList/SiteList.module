<?php
drupal_add_css(drupal_get_path('module', 'SiteList') .'/DataTables/smoothness/styles.css');
drupal_add_js(drupal_get_path('module', 'SiteList') .'/DataTables/media/js/jquery.js');
drupal_add_js(drupal_get_path('module', 'SiteList') .'/DataTables/media/js/jquery.dataTables.min.js');
drupal_add_js(drupal_get_path('module', 'SiteList') .'/DataTables/media/js/table_init.js');
function SiteList_help($path, $arg){
if($path == 'admin/help#SiteList'){
return t('Display a list of websites hosted at faculty.ucmerced.edu');
}
}

function SiteList_block_info(){
$blocks = array();
$blocks['site_list'] = array(
'info' => t('Display a list of websites hosted at faculty.ucmerced.edu.'),
'cache' => DRUPAL_NO_CACHE,
);
return $blocks;
}

function SiteList_block_view($block_name = ''){
   // drupal_add_js
if ($block_name == 'site_list'){
    $content = '<h2>Current Faculty Websites</h2><br/>';
    $query = db_select('field_data_field_ucm_site_description', 'd');
    $query->join('field_data_field_site_name', 'n', 'd.entity_id = n.entity_id');
    $query->fields('d', array('field_ucm_site_description_value'))
          ->fields('n', array('field_site_name_title', 'field_site_name_url'))
          ->orderBy('field_site_name_title', 'ASC');
    $result = $query->execute();
    $content .= '<table id="sitelist">' . "\n";
    $content .= "<thead><tr><th>Site</th><th>Description</th></tr></thead>\n";
    $content .= "<tbody>\n";
    while($record = $result->fetchAssoc()){
        $content .= '<tr><td><a href="' . $record['field_site_name_url'] . '">' . $record['field_site_name_title'] . "</a></td>\n";
        $content .= '<td>' . $record['field_ucm_site_description_value'] . "</td></tr>\n";
    }
    $content .= "</tbody>\n";
    $content .= "</table>";
    $block = array (
    'content' => $content,
    );

    return $block;

    }
}
?>
