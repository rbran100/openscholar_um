<?php

function SiteList_help($path, $arg){
if($path == 'admin/help#SiteList'){
return t('Display a list of websites hosted at faculty.ucmerced.edu');
}
}

function SiteList_block_info(){
$blocks = array();
$blocks['site_list'] = array(
'info' => t('Display a list of websites hosted at faculty.ucmerced.edu.'),
'cache' => DRUPAL_NO_CACHE,
);
return $blocks;
}

function SiteList_block_view($block_name = ''){
if ($block_name == 'site_list'){
    $content = '<h3>Current Faculty Websites</h3>';
    
    $query = db_select('field_data_field_ucm_site_description', 'd');
    $query->join('field_data_field_site_name', 'n', 'd.entity_id = n.entity_id');
    $query->fields('d', array('field_ucm_site_description_value'))
          ->fields('n', array('field_site_name_title', 'field_site_name_url'));
    $result = $query->execute();
    while($record = $result->fetchAssoc()){
        $content .= '<a href="' . $record['field_site_name_url'] . '">' . $record['field_site_name_title'] . '</a>';
        $content .= '<br/>' . $record['field_ucm_site_description_value'] . '<br/><br/>';
    }
    
    $block = array (
    'content' => $content,
    );

    return $block;

    }
}
?>
